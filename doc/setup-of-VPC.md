# VPC作成手順  
  
## 【概要】  
AWSにおけるプライベートネットワーク環境を構築する。
## 【目的】  
AWS上でサーバを稼働させるためには専用のプライベートネットワーク空間を設ける必要があるため。
## 【手順】  
1. VPC作成  
    - [ ] 検索タブから「VPC」を検索し、画面遷移
    - [ ] 左タブにてい「VPC」を押下
    - [ ] 画面右上の「VPCを作成」を押下
    - [ ] 以下の値を設定し「VPCを作成」を押下    
      - [ ] 【VPCの設定】

        |       項目       |           値           |
        | :--------------: | :--------------------: |
        |     名前タグ     |     dr-prod-vpc01      |
        | IPv4CIDRブロック | IPv4 CIDR manual input |
        |     IPv4CIDR     |     192.168.0.0/22     |
        |    テナンシー    |       デフォルト       |
      - [ ] 【タグ】  
            追記なし  
     - [ ] VPCが正常に作成されていることを確認    

2. サブネット作成  
    - [ ] 左タブにて「サブネット」を押下
    - [ ] 画面右上の「サブネットを作成」を押下
    - [ ] 以下の値を設定し、「サブネットを作成」を押下  
     ※下記パラメータテーブルを参照し、【新しいサブネットを追加】を押下し、作成するサブネット分手順を繰り返す  
      - [ ] サブネット1(dr-prod-public-subnet01)
        - [ ] 【VPC】  
            |  項目  |      値       |
            | :----: | :-----------: |
            | VPC ID | dr-prod-vpc01 |
        - [ ] 【サブネットの設定】  
            |          項目          |           値            |
            | :--------------------: | :---------------------: |
            |      サブネット名      | dr-prod-public-subnet01 |
            | アベイラビリティゾーン |     ap-northeast-1a     |
            |   IPv4 CIDR ブロック   |     192.168.0.0/24      |
            |          タグ          |        追記なし         |

      - [ ] サブネット2(dr-prod-public-subnet02)
        - [ ] 【VPC】  
            |  項目  |      値       |
            | :----: | :-----------: |
            | VPC ID | dr-prod-vpc01 |
        - [ ] 【サブネットの設定】  
            |          項目          |           値            |
            | :--------------------: | :---------------------: |
            |      サブネット名      | dr-prod-public-subnet02 |
            | アベイラビリティゾーン |     ap-northeast-1c     |
            |   IPv4 CIDR ブロック   |     192.168.1.0/24      |
            |          タグ          |        追記なし         |

      - [ ] サブネット3(dr-prod-private-subnet01)
        - [ ] 【VPC】  
            |  項目  |      値       |
            | :----: | :-----------: |
            | VPC ID | dr-prod-vpc01 |
        - [ ] 【サブネットの設定】  
            |          項目          |            値            |
            | :--------------------: | :----------------------: |
            |      サブネット名      | dr-prod-private-subnet01 |
            | アベイラビリティゾーン |     ap-northeast-1a      |
            |   IPv4 CIDR ブロック   |      192.168.2.0/24      |
            |          タグ          |         追記なし         |

      - [ ] サブネット4(dr-prod-private-subnet02)
        - [ ] 【VPC】  
            |  項目  |      値       |
            | :----: | :-----------: |
            | VPC ID | dr-prod-vpc01 |
        - [ ] 【サブネットの設定】  
            |          項目          |            値            |
            | :--------------------: | :----------------------: |
            |      サブネット名      | dr-prod-private-subnet02 |
            | アベイラビリティゾーン |     ap-northeast-1c      |
            |   IPv4 CIDR ブロック   |      192.168.2.0/24      |
            |          タグ          |         追記なし         |
       
    - [ ] サブネットが作成されていることを確認   
   
3. インターネットゲートウェイ作成  
   - [ ] 左タブの「インターネットゲートウェイ」を押下
   - [ ] 「インターネットゲートウェイの作成」を押下
   - [ ] 以下の値を設定し、「インターネットゲートウェイの作成」を押下
     - [ ] 【インターネットゲートウェイの設定】  
        |   項目   |            値             |
        | :------: | :-----------------------: |
        | 名前タグ | dr-prod-internetGateway01 |
     - [ ] 【タグ】 
        | 項目  |    値    |
        | :---: | :------: |
        | タグ  | 追記なし |
   - [ ] インターネットゲートウェイが作成されていることを確認
   - [ ] 「アクション」タブを開き、「VPCにアタッチ」を押下
   - [ ] 以下の値を設定し、「インターネットゲートウェイのアタッチ」を押下
     - [ ] 【VPC】  
        |     項目      |      値       |
        | :-----------: | :-----------: |
        | 使用可能なVPC | dr-prod-vpc01 |
   - [ ] インターネットゲートウェイがVPCにアタッチされたことを確認 
    
4. ルートテーブル作成  
   - [ ] 左タブの「ルートテーブル」を押下
   - [ ] 「ルートテーブルを作成」を押下
   - [ ] 以下の値を設定し、「ルートテーブルを作成」を押下
   
     - [ ] ルートテーブル1 (dr-prod-private-rootTable01)
       - [ ] 【ルートテーブル設定】
          | 項目  |             値              |
          | :---: | :-------------------------: |
          | 名前  | dr-prod-private-rootTable01 |
          |  VPC  |        dr-prod-vpc01        |
       - [ ] タグ 
          | 項目  |    値    |
          | :---: | :------: |
          | タグ  | 追記なし |

     - [ ] ルートテーブル2 (dr-prod-public-rootTable01)
       - [ ] 【ルートテーブル設定】
          | 項目  |             値              |
          | :---: | :-------------------------: |
          | 名前  | dr-prod-private-rootTable01 |
          |  VPC  |        dr-prod-vpc01        |
       - [ ] タグ 
          | 項目  |    値    |
          | :---: | :------: |
          | タグ  | 追記なし |

   - [ ] ルートテーブルが作成されていることを確認
   - [ ] 以下の手順に沿ってルートテーブルの設定を行う  
     - [ ] ルートテーブル1 (dr-prod-private-rootTable01)
       - [ ] 「サブネットの関連付け」タブの、【明示的なサブネットの関連付け】項目にある「サブネットの関連付けを編集」を押下
       - [ ] 以下の値を選択し、「関連付けを保存」を押下  
         - [ ] 【利用可能なサブネット】  
            |           項目           |    値    |
            | :----------------------: | :------: |
            | dr-prod-private-subnet01 | チェック |
            | dr-prod-private-subnet02 | チェック |
        - [ ] サブネットの関連付けが更新されたことを確認    
      
     - [ ] ルートテーブル2 (dr-prod-public-rootTable01)
       - [ ] 「ルート」タブの、【ルート】項目にある「ルートを編集」を押下
       - [ ] 「ルートを追加」を押下
       - [ ] 以下の値を設定し、「変更を保存」を押下
            |    項目    |                                       値                                       |
            | :--------: | :----------------------------------------------------------------------------: |
            |   送信先   |                                   0.0.0.0/0                                    |
            | ターゲット | igw-<3.インターネットゲートウェイの作成>で作成したインターネットゲートウェイID |
       - [ ] ルートが更新されていることを確認  
            
       - [ ] 「サブネットの関連付け」タブの、【明示的なサブネットの関連付け】項目にある「サブネットの関連付けを編集」を押下
       - [ ] 以下の値を選択し、「関連付けを保存」を押下  
         - [ ] 【利用可能なサブネット】  
            |          項目           |    値    |
            | :---------------------: | :------: |
            | dr-prod-public-subnet01 | チェック |
            | dr-prod-public-subnet02 | チェック |
        - [ ] サブネットの関連付けが更新されたことを確認       
           
5. セキュリティグループ作成  
        
    - [ ] 左タブの「セキュリティグループ」を押下
    - [ ] 画面右上の「セキュリティグループを作成」を押下
    - [ ] 以下の設定を、セキュリティグループごとにそれぞれ追加し、「セキュリティグループを作成」を押下  
      - [ ] セキュリティグループ1
        - [ ] 【基本的な詳細】
            |          項目          |        値        |
            | :--------------------: | :--------------: |
            | セキュリティグループ名 | dr-prod-alb-sg01 |
            |          説明          |    allow-alb     |
            |          VPC           |  dr-prod-vpc01   |

      - [ ] セキュリティグループ2
        - [ ] 【基本的な詳細】
            |          項目          |        値        |
            | :--------------------: | :--------------: |
            | セキュリティグループ名 | dr-prod-ecs-sg01 |
            |          説明          |    allow-ecs     |
            |          VPC           |  dr-prod-vpc01   |

      - [ ] セキュリティグループ3
        - [ ] 【基本的な詳細】
            |          項目          |        値        |
            | :--------------------: | :--------------: |
            | セキュリティグループ名 | dr-prod-rds-sg01 |
            |          説明          |    allow-rds     |
            |          VPC           |  dr-prod-vpc01   |

    - [ ] セキュリティグループが作成されていることを確認  
 
    - [ ] 作成したセキュリティグループごとにルールを追加  
        - [ ] セキュリティグループ1 (dr-prod-alb-sg01)
          - [ ] インバウンドルール
            - [ ] 「インバウンドルールの編集」を押下
            - [ ] 「ルールの追加」を押下し、以下の設定を追加の上「ルールの保存」を押下
              - [ ] ルール1    
                |    項目    |         値         |
                | :--------: | :----------------: |
                |   タイプ   |       https        |
                | プロトコル |        TCP         |
                |   ソース   |     0.0.0.0/0      |
                |    説明    | http-from-internet |

          - [ ] アウトバウンドルール 
            - [ ] 「アウトバウンドルールの編集」を押下
            - [ ] 「ルールの追加」を押下し、以下の設定を追加の上「ルールの保存」を押下  
              - [ ] ルール1  
                |    項目    |        値        |
                | :--------: | :--------------: |
                |   タイプ   |       http       |
                | プロトコル |       TCP        |
                |   送信先   | dr-prod-ecs-sg01 |
                |    説明    |   http-to-ecs    |

              - [ ] ルール2  
                |    項目    |        値        |
                | :--------: | :--------------: |
                |   タイプ   |      https       |
                | プロトコル |       TCP        |
                |   送信先   | dr-prod-ecs-sg01 |
                |    説明    |   http-to-ecs    |
                
        - [ ] セキュリティグループ2 (dr-prod-ecs-sg01)
          - [ ] インバウンドルール
            - [ ] 「インバウンドルールの編集」を押下
            - [ ] 「ルールの追加」を押下し、以下の設定を追加の上「ルールの保存」を押下
              - [ ] ルール1    
                |    項目    |        値        |
                | :--------: | :--------------: |
                |   タイプ   |       http       |
                | プロトコル |       TCP        |
                |   ソース   | dr-prod-alb-sg01 |
                |    説明    |  http-from-alb   |

              - [ ] ルール2    
                |    項目    |        値        |
                | :--------: | :--------------: |
                |   タイプ   |      https       |
                | プロトコル |       TCP        |
                |   ソース   | dr-prod-alb-sg01 |
                |    説明    |  https-from-alb  |

          - [ ] アウトバウンドルール 
            - [ ] 「アウトバウンドルールの編集」を押下
            - [ ] 「ルールの追加」を押下し、以下の設定を追加の上「ルールの保存」を押下  
              - [ ] ルール1  
                |    項目    |        値        |
                | :--------: | :--------------: |
                |   タイプ   |   MySQL/Aurora   |
                | プロトコル |       TCP        |
                |   送信先   | dr-prod-rds-sg01 |
                |    説明    |      to-rds      |

              - [ ] ルール2  
                |    項目    |        値        |
                | :--------: | :--------------: |
                |   タイプ   |       http       |
                | プロトコル |       TCP        |
                |   送信先   | dr-prod-alb-sg01 |
                |    説明    |   http-to-alb    |

              - [ ] ルール3  
                |    項目    |        値        |
                | :--------: | :--------------: |
                |   タイプ   |      https       |
                | プロトコル |       TCP        |
                |   送信先   | dr-prod-alb-sg01 |
                |    説明    |   http-to-alb    |



        - [ ] セキュリティグループ3 (dr-prod-rds-sg01)
          - [ ] インバウンドルール
            - [ ] 「インバウンドルールの編集」を押下
            - [ ] 「ルールの追加」を押下し、以下の設定を追加の上「ルールの保存」を押下
              - [ ] ルール1    
                |        項目        |        値        |
                | :----------------: | :--------------: |
                | タイプMySQL/Aurora |
                |     プロトコル     |       TCP        |
                |       ソース       | dr-prod-ecs-sg01 |
                |        説明        |     from-ecs     |

          - [ ] アウトバウンドルール 
            - [ ] 「アウトバウンドルールの編集」を押下
            - [ ] 「ルールの追加」を押下し、以下の設定を追加の上「ルールの保存」を押下  
              - [ ] ルール1  
                |    項目    |  値   |
                | :--------: | :---: |
                |   タイプ   | 全て  |
                | プロトコル | 全て  |
                |   送信先   |       |
                |    説明    |  all  |
            
   - [ ] 作成したルールが登録されていることを確認

